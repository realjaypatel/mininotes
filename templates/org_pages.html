{% extends "base.html" %}
{% block title %}{{ org.name }} - Pages{% endblock %}

{% block header %}
<header class="masthead" style="background-image: url('{{ url_for('static', filename='assets/img/home-bg.jpg') }}')">
  <div class="container text-center text-white"></div>
</header>
{% endblock %}

{% block content %}
<div class="container px-4 px-lg-5 mt-5">

  <!-- Search Bar + View Toggle -->
  <div class="d-flex mb-4 align-items-center">
    <form method="GET" action="{{ url_for('search', org_id=org._id) }}" class="d-flex flex-grow-1 me-3">
      <input type="text" class="form-control me-2" name="q" placeholder="Search pages..." required>
      <button type="submit" class="btn btn-primary">Search</button>
    </form>

    <!-- View Toggle Buttons as small icons -->
    <div class="btn-group" role="group" aria-label="View toggle">
      <button type="button" class="btn btn-outline-secondary btn-sm active" data-view="list" title="List View">
        <i class="bi bi-list">L</i>
      </button>
      <button type="button" class="btn btn-outline-secondary btn-sm" data-view="card" title="Card View">
        <i class="bi bi-grid-3x3-gap">C</i>
      </button>
      <button type="button" class="btn btn-outline-secondary btn-sm" data-view="table" title="Table View">
        <i class="bi bi-table">T</i>
      </button>
    </div>
  </div>

  <!-- List View (default) -->
  <div id="view-list">
    {% if pages %}
      {% for page in pages %}
        <div class="post-preview mb-4 p-3 border rounded shadow-sm hover-shadow">
          <a href="/{{ org._id }}/page/{{ page.page_id }}" class="text-decoration-none text-dark">
            <h5 class="mb-1">{{ page.title }}</h5>
            <p class="text-muted mb-0">{{ page.subtitle }}</p>
            <small class="text-muted">ID: {{ page.page_id }} | Visibility: {{ page.visibility }} | Category: {{ page.category }} | Tags: {{ page.tags }}</small>
          </a>
        </div>
      {% endfor %}
    {% else %}
      <p>No pages yet. Create one below!</p>
    {% endif %}
  </div>

  <!-- Card View -->
  <div id="view-card" class="row g-4 d-none">
    {% for page in pages %}
      <div class="col-md-6 col-lg-4">
        <div class="card shadow-sm h-100 hover-shadow border-0 rounded-3">
          <div class="card-body d-flex flex-column justify-content-between">
            <div>
              <h5 class="card-title">{{ page.title }}</h5>
              <p class="card-text text-muted">{{ page.subtitle }}</p>
              <small class="text-muted">ID: {{ page.page_id }} | Visibility: {{ page.visibility }} | Category: {{ page.category }} | Tags: {{ page.tags }}</small>
            </div>
            <a href="/{{ org._id }}/page/{{ page._id }}" class="btn btn-sm btn-primary mt-3 align-self-start">Open</a>
          </div>
        </div>
      </div>
    {% endfor %}
  </div>

  <!-- Table View -->
  <div id="view-table" class="table-responsive d-none">
    <table class="table align-middle table-hover border rounded shadow-sm mb-0">
      <thead class="table-light">
        <tr>
          <th>Page ID</th>
          <th>Title</th>
          <th>Subtitle</th>
          <th>Category</th>
          <th>Tags</th>
          <th>Visibility</th>
          <th class="text-end">Action</th>
        </tr>
      </thead>
      <tbody>
        {% for page in pages %}
        <tr class="hover-shadow-sm">
          <td>{{ page.page_id }}</td>
          <td>{{ page.title }}</td>
          <td class="text-muted">{{ page.subtitle }}</td>
          <td>{{ page.category }}</td>
          <td>{{ page.tags }}</td>
          <td>{{ page.visibility }}</td>
          <td class="text-end">
            <a href="/{{ org._id }}/page/{{ page.page_id }}" class="btn btn-sm btn-outline-primary">View</a>
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>

  <a class="btn btn-primary mt-4" href="/{{ org._id }}/new">+ Create New Page</a>
</div>

<style>
/* Masthead */
@media (min-width: 992px) {
  header.masthead {
    padding-top: 3rem;
    padding-bottom: 1rem;
  }
}

/* View toggle active button */
.btn-group .btn.active {
  background-color: #0d6efd;
  color: #fff;
  border-color: #0d6efd;
}

/* Hover effects for cards and list */
.hover-shadow:hover {
  box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1) !important;
  transition: 0.3s;
}
.hover-shadow-sm:hover {
  box-shadow: 0 2px 10px rgba(0,0,0,0.08) !important;
  transition: 0.3s;
}

/* Card customization */
.card {
  transition: 0.3s;
}
.card:hover {
  transform: translateY(-3px);
}

/* Table customization */
.table-hover tbody tr:hover {
  background-color: #f8f9fa;
}
.table td, .table th {
  vertical-align: middle;
}
</style>

<script>
document.addEventListener('DOMContentLoaded', () => {
  const buttons = document.querySelectorAll('.btn-group button');
  const views = ['list', 'card', 'table'];

  buttons.forEach(btn => {
    btn.addEventListener('click', () => {
      buttons.forEach(b => b.classList.remove('active'));
      btn.classList.add('active');

      views.forEach(v => {
        const el = document.getElementById('view-' + v);
        if(el) el.classList.add('d-none');
      });

      const view = btn.getAttribute('data-view');
      document.getElementById('view-' + view).classList.remove('d-none');
    });
  });
});
</script>
{% endblock %}
