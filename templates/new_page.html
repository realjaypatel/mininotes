{% extends "base.html" %}
{% block title %}New Page{% endblock %}

{% block header %}
<header class="masthead" style="background-image: url('{{ url_for('static', filename='assets/img/about-bg.jpg') }}')">
  <div class="container position-relative px-4 px-lg-5">
    <div class="row gx-4 gx-lg-5 justify-content-center">
      <div class="col-12 text-center text-white">
        <!-- Empty header as requested -->
      </div>
    </div>
  </div>
</header>
{% endblock %}

{% block content %}
<div class="container px-4 px-lg-5 mt-5">
  <form method="POST" id="form">
    <!-- Title -->
    <div class="form-group mb-3">
      <input type="text" class="form-control form-control-plaintext title-input" name="title" placeholder="Page title" required>
    </div>

    <!-- Subtitle / Headline -->
    <div class="form-group mb-3">
      <input type="text" class="form-control form-control-plaintext" name="subtitle" placeholder="Subtitle / Headline">
    </div>

    <!-- Content -->
    <div class="form-group mb-3">
      <textarea id="content" name="content" class="form-control form-control-plaintext" rows="10" required></textarea>
    </div>


     Category:;
<!-- Category -->
<div class="form-group mb-3">
  <input type="text" name="category" class="form-control form-control-plaintext" placeholder="Enter category" required>
</div>

    <!-- Ticket Fields: Assign By / Assign To -->

    Visibility:
    <!-- Visibility -->
    <div class="form-group mb-3">
      <select name="visibility" class="form-select form-select-plaintext" required>
        <option value="Team">Team</option>
        <option value="Public">Public</option>
      </select>
    </div>

        <!-- Status -->
    Status : 
    <div class="form-group mb-3">
      <select name="status" class="form-select form-select-plaintext">
        <option value="pending" selected>Pending</option>
        <option value="completed">Completed</option>
      </select>
    </div>

    <!-- Background Image -->
    <div class="form-group mb-3">
      <input type="file" class="form-control form-control-plaintext" id="bgimg_file" accept="image/*">
      <input type="hidden" id="bgimg" name="bgimg">
    </div>

    <button class="btn btn-primary mt-3">Create Page</button>
  </form>
</div>

<!-- Summernote and Image Upload JS -->
<link href="https://cdn.jsdelivr.net/npm/summernote@0.8.20/dist/summernote.min.css" rel="stylesheet">
<script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/summernote@0.8.20/dist/summernote.min.js"></script>

<script>
  $(document).ready(function() {
    $('#content').summernote({ height: 400 });

    // Convert uploaded background image to base64
    $('#bgimg_file').on('change', function(event) {
      const file = event.target.files[0];
      if (file) {
        const reader = new FileReader();
        reader.onload = function(e) {
          $('#bgimg').val(e.target.result);
        };
        reader.readAsDataURL(file);
      }
    });

    // Show ticket fields if category is Ticket
    $('#category').on('change', function() {
      if ($(this).val() === 'Ticket') {
        $('#ticket-fields').show();
      } else {
        $('#ticket-fields').hide();
      }
    });

    // Trigger change on page load
    $('#category').trigger('change');
  });
</script>

<style>
  #form {
    margin: 20px auto;
    width: 100%;
    max-width: none;
    padding: 20px;
    border-radius: 8px;
    background-color: #f9f9f9;
    box-shadow: 0 2px 8px rgba(0,0,0,0.05);
  }

  .title-input {
    font-size: 2.5rem;
    font-weight: bold;
    padding: 10px 0;
  }

  /* Confluence-style input: no borders, subtle underline on focus */
  .form-control-plaintext {
    border: none;
    background-color: transparent;
    border-bottom: 1px solid #ddd;
    border-radius: 0;
    padding-left: 0;
    padding-right: 0;
  }

  .form-control-plaintext:focus {
    outline: none;
    border-bottom: 2px solid #0d6efd;
    background-color: transparent;
    box-shadow: none;
  }

  .form-select-plaintext {
    border: none;
    background-color: transparent;
    border-bottom: 1px solid #ddd;
    border-radius: 0;
    padding-left: 0;
    padding-right: 0;
  }

  .form-select-plaintext:focus {
    outline: none;
    border-bottom: 2px solid #0d6efd;
    box-shadow: none;
  }

  @media (min-width: 992px) {
      header.masthead {
          padding-top: 3rem;
          padding-bottom: 1rem;
      }
  }
</style>
{% endblock %}
